from gzip import compress
import urllib3
import boto3
import json
import os

CISA_URL = os.getenv('CISA_URL')
BUCKETNAME = os.getenv('BUCKETNAME')
KEY = os.getenv('KEY')

def lambda_handler(event, context):
    http = urllib3.PoolManager()
    resp = http.request("GET", CISA_URL)
    if resp.status == 200:
        boto3.client('s3').put_object(Body=compress(json.dumps(json.loads(resp.data)).encode()), Bucket=BUCKETNAME, Key=KEY)
    